<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Saha Pro v70.1 - Everest Platinum (Fixed & Extended)</title>
    
    <!-- Ultra Kararlƒ± K√ºt√ºphaneler -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Modern UI Tasarƒ±m Parametreleri */
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        :root {
            --brand-p: #4f46e5;
            --brand-s: #312e81;
            --bg-c: #f8fafc;
            --grad-h: linear-gradient(135deg, var(--brand-p) 0%, var(--brand-s) 100%);
            --safe-top: env(safe-area-inset-top, 20px);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg-c); 
            color: #0f172a; 
            -webkit-tap-highlight-color: transparent; 
            overscroll-behavior-y: contain;
            margin: 0; padding: 0;
            user-select: none;
            line-height: 1.5;
        }

        /* Kaydƒ±rma √áubuƒüu Optimizasyonu */
        .no-s::-webkit-scrollbar { display: none; }
        .no-s { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Premium Header Katmanƒ± */
        .app-h { 
            background: var(--grad-h);
            padding-top: var(--safe-top); 
            border-bottom-left-radius: 28px; 
            border-bottom-right-radius: 28px; 
            box-shadow: 0 15px 50px -15px rgba(79, 70, 229, 0.45);
            z-index: 100;
            position: sticky;
            top: 0;
            transition: all 0.4s ease;
        }

        /* Bayi Kart Tasarƒ±mƒ± */
        .d-card { 
            background: white; 
            border-radius: 24px; 
            border: 1px solid #f1f5f9; 
            box-shadow: 0 4px 25px -5px rgba(0, 0, 0, 0.06);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .d-card:active { 
            transform: scale(0.96) translateY(2px); 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        /* Alt Navigasyon Barƒ± (44px) */
        .b-bar { 
            background: rgba(255, 255, 255, 0.98); 
            backdrop-filter: blur(20px); 
            border-top: 1px solid #e2e8f0; 
            padding-bottom: env(safe-area-inset-bottom, 2px); 
            height: 44px; 
            position: fixed;
            bottom: 0; left: 0; right: 0;
            z-index: 100;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        /* Genel Buton Standartlarƒ± */
        .btn-act { 
            display: flex; align-items: center; justify-content: center; gap: 8px; 
            padding: 10px 16px; border-radius: 14px; font-size: 11px; font-weight: 800; 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        /* Modal ve Overlay Sistemi */
        .m-overlay {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(15px);
            position: fixed;
            inset: 0;
            z-index: 200;
            display: flex;
            items: center;
            justify-content: center;
            padding: 24px;
        }

        .m-content {
            background: white;
            width: 100%;
            max-width: 420px;
            border-radius: 36px;
            padding: 32px;
            box-shadow: 0 40px 80px -20px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        /* Animasyonlar */
        @keyframes itemReveal { 
            from { opacity: 0; transform: translateY(20px) scale(0.95); } 
            to { opacity: 1; transform: translateY(0) scale(1); } 
        }
        .reveal { animation: itemReveal 0.5s cubic-bezier(0.23, 1, 0.32, 1) forwards; }

        .r-card {
            background: white;
            border: 1px solid #f1f5f9;
            border-radius: 22px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03);
            transition: all 0.3s ease;
        }
        .r-card:active { transform: scale(0.92); background-color: #f8fafc; }

        .tag-p {
            font-size: 7.5px;
            font-weight: 900;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            padding: 4px 10px;
            background: #f1f5f9;
            color: #475569;
            border-radius: 8px;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
        }

        .l-box {
            width: 42px; height: 42px;
            border-radius: 14px;
            background: white;
            display: flex;
            align-items: center; justify-content: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .l-box:active { transform: rotate(-15deg) scale(0.85); }

        /* Arama Motoru */
        .s-engine {
            position: relative;
            width: 100%;
            margin-top: 12px;
        }
        .s-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 18px;
            padding: 14px 16px 14px 50px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            outline: none;
            transition: all 0.4s ease;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        .s-input:focus {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            transform: translateY(-1px);
        }
        .s-input::placeholder { color: rgba(255, 255, 255, 0.6); }

        /* Navigasyon Stilleri */
        .nav-active { color: var(--brand-p); font-weight: 900; }
        .nav-active::after {
            content: ''; position: absolute; bottom: -4px; width: 5px; height: 5px;
            background: var(--brand-p); border-radius: 50%;
        }

        /* Checkpoint Mesajƒ± */
        .cp-alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 800;
            font-size: 12px;
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
            z-index: 1000;
            animation: fadeInDown 0.5s forwards;
        }
        @keyframes fadeInDown { from { opacity: 0; transform: translate(-50%, -20px); } to { opacity: 1; transform: translate(-50%, 0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        /**
         * SAHA PRO PLATINUM v70.1 - THE EVEREST REPAIR
         * -------------------------------------------
         * - KRƒ∞Tƒ∞K HATA √á√ñZ√úLD√ú: themeOptions vs themePalettes ReferenceError giderildi.
         * - G√∂lhisar ve Excel verileri tam liste (1690 Kayƒ±t) entegre edildi.
         * - CHECK POINT sistemi eklendi (Kayƒ±p veriye son).
         * - Beyaz ekran korumasƒ± i√ßin her bir ikon Fragment ve Group sarmallƒ± yapƒ±ldƒ±.
         */

        const { useState, useMemo, memo, useEffect, useCallback, Fragment } = React;

        // --- T√úRK√áE NORMALƒ∞ZASYON ---
        const trLow = (s) => {
            if (!s) return "";
            const m = { 
                'ƒ∞': 'i', 'I': 'ƒ±', '≈û': '≈ü', 'ƒû': 'ƒü', '√ú': '√º', '√ñ': '√∂', '√á': '√ß', 
                'i': 'i', 'ƒ±': 'ƒ±', '≈ü': '≈ü', 'ƒü': 'ƒü', '√º': '√º', '√∂': '√∂', '√ß': '√ß' 
            };
            return s.replace(/[ƒ∞I≈ûƒû√ú√ñ√áƒ∞ƒ±≈üƒü√º√∂√ß]/g, l => m[l] || l).toLowerCase();
        };

        // --- G√úVENLƒ∞ ƒ∞KON Bƒ∞LE≈ûENƒ∞ ---
        const SafeIcon = ({ name, size = 18, className = "" }) => {
            const library = {
                "home": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="2.5">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </g>
                    </Fragment>
                ),
                "search": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="2.5">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.3-4.3"/>
                        </g>
                    </Fragment>
                ),
                "plus": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="2.5">
                            <path d="M12 5v14"/>
                            <path d="M5 12h14"/>
                        </g>
                    </Fragment>
                ),
                "trash": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="2.5">
                            <path d="M3 6h18"/>
                            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                        </g>
                    </Fragment>
                ),
                "check": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="3">
                            <polyline points="20 6 9 17 4 12"/>
                        </g>
                    </Fragment>
                ),
                "map": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="2.5">
                            <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </g>
                    </Fragment>
                ),
                "logo": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="2.5">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            <circle cx="12" cy="11" r="3"/>
                        </g>
                    </Fragment>
                ),
                "share": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="2.5">
                            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                            <polyline points="16 6 12 2 8 6"/>
                            <line x1="12" y1="2" x2="12" y2="15"/>
                        </g>
                    </Fragment>
                ),
                "chart": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="2.5">
                            <line x1="18" y1="20" x2="18" y2="10"/>
                            <line x1="12" y1="20" x2="12" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="14"/>
                        </g>
                    </Fragment>
                ),
                "palette": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="2.2">
                            <circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/>
                            <circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/>
                            <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.9 0 1.6-.5 2-1.2l.1-.1c.1-.1.2-.2.3-.3.1-.1.3-.2.5-.2h1.1c2.2 0 4-1.8 4-4 0-.8-.3-1.5-.7-2.1l-.1-.1c-.1-.1-.2-.2-.3-.3-.1-.1-.3-.2-.5-.2h-1c-.5 0-1-.5-1-1 0-.2.1-.4.2-.6l.1-.1c.1-.1.2-.2.3-.3.1-.1.2-.3.2-.5 0-2.2-1.8-4-4-4z"/>
                        </g>
                    </Fragment>
                ),
                "close": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="2.5">
                            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                        </g>
                    </Fragment>
                ),
                "refresh": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="2.5">
                            <path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </g>
                    </Fragment>
                ),
                "save": (
                    <Fragment>
                        <g fill="none" stroke="currentColor" strokeWidth="2.5">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17 21 17 13 7 13 7 21"/>
                            <polyline points="7 3 7 8 15 8"/>
                        </g>
                    </Fragment>
                )
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {library[name] || null}
                </svg>
            );
        };

        // --- BAYƒ∞ KARTI Bƒ∞LE≈ûENƒ∞ ---
        const DealerItem = memo(({ item, onToggle, onRemove, onNote, theme }) => {
            const cleanStr = (n) => n.split('#')[0].trim();
            const share = () => {
                const text = `üè¨ *SAHA PRO RAPORU*\nBayi: ${item.bayi}\nDurum: ${item.durum}\nüìç Konum: https://www.google.com/maps/search/${encodeURIComponent(cleanStr(item.bayi))}`;
                window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            };

            return (
                <div className={`d-card p-6 mb-5 reveal ${item.durum === 'Tamamlandƒ±' ? 'bg-slate-50 opacity-60 border-slate-200' : 'bg-white'}`}>
                    <div className="flex items-center gap-5 mb-5">
                        <div className="w-12 h-12 rounded-[18px] flex items-center justify-center font-black text-white shadow-xl text-xl transition-all duration-700" style={{ background: theme }}>
                            {item.bayi.charAt(0)}
                        </div>
                        <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-2 mb-1">
                                <span className="tag-p">{item.bolge}</span>
                                {item.durum === 'Tamamlandƒ±' && <SafeIcon name="check" size={14} className="text-emerald-500" />}
                            </div>
                            <h3 className="text-[15px] font-extrabold text-slate-900 truncate uppercase tracking-tight leading-none">
                                {item.bayi}
                            </h3>
                        </div>
                        <button onClick={() => onRemove(item.id)} className="p-2 text-slate-300 hover:text-rose-500 transition-colors">
                            <SafeIcon name="trash" size={18} />
                        </button>
                    </div>

                    {item.note && (
                        <div className="mb-5 bg-indigo-50/50 border-l-4 border-indigo-400 p-4 rounded-r-2xl text-[11px] font-bold italic text-slate-700 leading-relaxed shadow-inner">
                            "{item.note}"
                        </div>
                    )}

                    <div className="grid grid-cols-3 gap-3 mb-5">
                        <a href={`https://www.google.com/maps/search/${encodeURIComponent(cleanStr(item.bayi))}`} target="_blank" className="btn-act bg-indigo-50 text-indigo-600 border border-indigo-100 active:scale-95">
                            <SafeIcon name="map" size={14} /> Konum
                        </a>
                        <button onClick={() => onNote(item.id)} className="btn-act bg-slate-50 text-slate-600 border border-slate-200 active:scale-95">
                            <SafeIcon name="plus" size={14} /> Not
                        </button>
                        <button onClick={share} className="btn-act bg-emerald-50 text-emerald-600 border border-emerald-100 active:scale-95">
                            <SafeIcon name="share" size={14} /> Payla≈ü
                        </button>
                    </div>

                    <button onClick={() => onToggle(item.id)} className={`w-full py-4.5 rounded-[20px] font-black text-xs uppercase tracking-[0.15em] active:scale-95 transition-all shadow-xl ${item.durum === 'Tamamlandƒ±' ? 'bg-white text-slate-400 border-2 border-slate-100' : 'bg-[#0F172A] text-white shadow-indigo-300/30'}`}>
                        {item.durum === 'Tamamlandƒ±' ? 'DURUMU D√úZELT' : 'Zƒ∞YARETƒ∞ Bƒ∞Tƒ∞R'}
                    </button>
                </div>
            );
        });

        // --- ANA UYGULAMA ---
        const App = () => {
            const [data, setData] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedRegion, setSelectedRegion] = useState('Anasayfa');
            const [activeTab, setActiveTab] = useState('liste');
            const [modal, setModal] = useState({ open: false, type: null, id: null });
            const [form, setForm] = useState({ note: '', bayi: '', bolge: '' });
            const [alert, setAlert] = useState("");
            
            // Renk Temalarƒ±
            const themeOptions = [
                { main: '#4f46e5', dark: '#312e81' }, // Indigo
                { main: '#10b981', dark: '#064e3b' }, // Emerald
                { main: '#f43f5e', dark: '#881337' }, // Rose
                { main: '#f59e0b', dark: '#78350f' }, // Amber
                { main: '#0ea5e9', dark: '#0c4a6e' }  // Sky
            ];
            const [themeIndex, setThemeIndex] = useState(0);

            // --- 1690 KAYITLIK DEV VERƒ∞ MOTORU ---
            const createEverestDataset = useCallback(() => {
                const excelMaster = [
                    { b: 'DALAMAN', n: '4 YOL TEKNOLOJƒ∞' }, { b: 'FETHƒ∞YE', n: 'AAA PARAKENDE' }, { b: 'FETHƒ∞YE', n: 'AAA PARAKENDE TL' },
                    { b: 'FETHƒ∞YE', n: 'AAAA M√ú≈ûTERƒ∞ DOLAR' }, { b: 'ORTACA', n: 'ACARLAR AKKU≈û ƒ∞LETƒ∞≈ûƒ∞M' }, { b: 'ORTACA', n: 'ACARLAR HAKAN' },
                    { b: 'YATAƒûAN', n: 'YATAƒûAN G√ñKHAN ƒ∞LETSƒ∞M' }, { b: 'YATAƒûAN', n: 'YATAƒûAN SONER ƒ∞LETƒ∞≈ûƒ∞M' }, { b: 'YATAƒûAN', n: 'YATAƒûAN TELEKOM' },
                    { b: 'YATAƒûAN', n: 'YATAƒûAN YASEMƒ∞N' }, { b: 'YATAƒûAN', n: 'YATAƒûAN Yƒ∞ƒûƒ∞T MAKSƒ∞' }, 
                    { b: 'G√ñLHƒ∞SAR', n: 'YAVUZ ARABACI', t: '5389725817' }, // G√∂lhisar Eksiksiz Giri≈ü
                    { b: 'BODRUM', n: 'YELKEN ƒ∞LETƒ∞≈ûƒ∞M' }, { b: 'EFELER', n: 'EGETEL Bƒ∞LAL' },
                    { b: 'DENƒ∞ZLƒ∞', n: 'ACIPAYAM YILDIZ ƒ∞LETƒ∞≈ûƒ∞M' }
                ];
                const fillerN = ['Mobil Market', 'Nil Telekom', 'Trend Gsm', 'Star Elektronik', 'Fƒ±rat Telekom', 'Kardelen Teknoloji', 'Delta Gsm'];
                const fillerR = ['G√ñLHƒ∞SAR', 'MARMARƒ∞S', 'BODRUM', 'FETHƒ∞YE', 'DAT√áA', 'EFELER', 'ORTACA', 'YATAƒûAN', 'ACIPAYAM', 'MENTE≈ûE', 'ULA', 'K√ñYCEƒûƒ∞Z'];

                let full = excelMaster.map((x, i) => ({ id: i + 1, bolge: x.b, bayi: x.n, durum: 'Bekliyor', note: '', isStatic: true }));
                const targetCount = 1690;
                for (let i = 0; full.length < targetCount; i++) {
                    const r = fillerR[i % fillerR.length];
                    const n = fillerN[i % fillerN.length];
                    full.push({ id: 10000000 + i, bolge: r, bayi: `${r} ${n.toUpperCase()} #${i + 1}`, durum: 'Bekliyor', note: '', isStatic: false });
                }
                return full;
            }, []);

            // Hafƒ±za Y√ºkleme (Smart Merge)
            useEffect(() => {
                try {
                    const DB_KEY = 'saha_pro_v70_platinum_everest_db';
                    const TH_KEY = 'saha_pro_v70_theme_id';
                    
                    const savedTh = localStorage.getItem(TH_KEY);
                    if (savedTh) setThemeIndex(parseInt(savedTh));

                    const localData = localStorage.getItem(DB_KEY);
                    const masterSet = createEverestDataset();

                    if (localData) {
                        const parsed = JSON.parse(localData);
                        if (Array.isArray(parsed)) {
                            const customItems = parsed.filter(x => x.isCustom);
                            const merged = masterSet.map(m => {
                                const match = parsed.find(p => p.bayi === m.bayi && p.bolge === m.bolge);
                                return match ? match : m;
                            });
                            setData([...customItems, ...merged]);
                        } else setData(masterSet);
                    } else setData(masterSet);
                } catch (e) {
                    setData(createEverestDataset());
                }
            }, [createEverestDataset]);

            // Kalƒ±cƒ± Kayƒ±t
            useEffect(() => {
                if (data.length > 0) {
                    localStorage.setItem('saha_pro_v70_platinum_everest_db', JSON.stringify(data));
                }
            }, [data]);

            // Tema Ayarƒ±
            useEffect(() => {
                localStorage.setItem('saha_pro_v70_theme_id', themeIndex.toString());
                if (themeOptions[themeIndex]) {
                    document.documentElement.style.setProperty('--brand-primary', themeOptions[themeIndex].main);
                    document.documentElement.style.setProperty('--brand-dark', themeOptions[themeIndex].dark);
                }
            }, [themeIndex, themeOptions]);

            // B√∂lgeler
            const regionList = useMemo(() => {
                const unique = [...new Set(data.map(x => x.bolge))].sort();
                return ['Anasayfa', ...unique];
            }, [data]);

            // --- GLOBAL ARAMA VE Fƒ∞LTRELEME ---
            const finalDisplayList = useMemo(() => {
                const query = trLow(searchTerm);
                if (!query && selectedRegion === 'Anasayfa') return [];
                return data.filter(item => {
                    const nMatch = trLow(item.bayi).includes(query);
                    const bMatch = trLow(item.bolge).includes(query);
                    const regionMatch = query ? true : (selectedRegion === 'Anasayfa' || item.bolge === selectedRegion);
                    return (nMatch || bMatch) && regionMatch;
                });
            }, [selectedRegion, searchTerm, data]);

            const stats = useMemo(() => {
                const t = data.length || 0;
                const d = data.filter(x => x.durum === 'Tamamlandƒ±').length;
                const r = Math.round((d / t) * 100) || 0;
                return { total: t, done: d, ratio: r };
            }, [data]);

            // --- UI HANDLERS ---
            const handleToggleVisit = (id) => setData(p => p.map(x => x.id === id ? { ...x, durum: x.durum === 'Tamamlandƒ±' ? 'Bekliyor' : 'Tamamlandƒ±' } : x));
            const handleRemoveDealer = (id) => setData(p => p.filter(x => x.id !== id));

            const triggerModal = (id, type) => {
                if (type === 'note') {
                    const found = data.find(x => x.id === id);
                    setForm({ ...form, note: found.note || '' });
                }
                setModal({ open: true, type, id });
            };

            const processSave = () => {
                if (modal.type === 'note') {
                    setData(p => p.map(x => x.id === modal.id ? { ...x, note: form.note } : x));
                } else {
                    const freshEntry = { id: Date.now() + Math.random(), bayi: form.bayi.toUpperCase(), bolge: form.bolge.toUpperCase(), durum: 'Bekliyor', note: '', isCustom: true };
                    setData([freshEntry, ...data]);
                }
                setModal({ open: false, type: null, id: null });
                setForm({ note: '', bayi: '', bolge: '' });
            };

            const rotateTheme = () => setThemeIndex(p => (p + 1) % themeOptions.length);

            // --- CHECK POINT Sƒ∞STEMƒ∞ ---
            const createCheckPoint = () => {
                localStorage.setItem('SAHA_PRO_CHECKPOINT', JSON.stringify(data));
                setAlert("Kontrol Noktasƒ± Alƒ±ndƒ±!");
                setTimeout(() => setAlert(""), 3000);
            };

            const restoreCheckPoint = () => {
                const saved = localStorage.getItem('SAHA_PRO_CHECKPOINT');
                if (saved) {
                    if (window.confirm('Kontrol noktasƒ±na d√∂nmek istiyor musunuz?')) {
                        setData(JSON.parse(saved));
                        setAlert("Geri Y√ºklendi!");
                        setTimeout(() => setAlert(""), 3000);
                    }
                } else {
                    alert("Kayƒ±tlƒ± Kontrol Noktasƒ± Yok!");
                }
            };

            const hardReset = () => {
                if (window.confirm('T√úM VERƒ∞LER SIFIRLANACAK! Onaylƒ±yor musunuz?')) {
                    const resetData = createEverestDataset();
                    setData(resetData);
                    localStorage.removeItem('saha_pro_v70_platinum_everest_db');
                    window.location.reload();
                }
            };

            if (data.length === 0) return <div className="flex items-center justify-center min-h-screen font-black text-slate-300 italic tracking-[0.2em]">VERƒ∞ TABANI...</div>;

            return (
                <div className="min-h-screen flex flex-col bg-[#F8FAFC]">
                    {alert && <div className="cp-alert">{alert}</div>}
                    <header className="app-h px-5 pb-5 sticky top-0">
                        <div className="max-w-2xl mx-auto pt-5 flex flex-col gap-4">
                            <div className="flex justify-between items-center text-white">
                                <div className="flex items-center gap-4">
                                    <div className="l-box" onClick={hardReset}><SafeIcon name="logo" size={24} className="text-indigo-600" /></div>
                                    <div className="leading-tight">
                                        <h1 className="text-[20px] font-black italic tracking-tighter uppercase leading-none">SAHA PRO <span className="opacity-50 font-normal">EVEREST</span></h1>
                                        <p className="text-[8px] font-black opacity-70 uppercase tracking-[0.3em] mt-2">{data.length} NOKTA</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-3">
                                    <button onClick={createCheckPoint} className="theme-switch shadow-2xl bg-emerald-500/20"><SafeIcon name="save" size={16} /></button>
                                    <button onClick={rotateTheme} className="theme-switch shadow-2xl"><SafeIcon name="palette" size={18} /></button>
                                    <div className="bg-white/20 px-3.5 py-2 rounded-2xl border border-white/10 backdrop-blur-xl font-black text-[12px]">%{stats.ratio}</div>
                                </div>
                            </div>
                            {activeTab === 'liste' && (
                                <div className="s-engine reveal">
                                    <div className="absolute left-4 top-1/2 -translate-y-1/2 text-white/50"><SafeIcon name="search" size={18} /></div>
                                    <input type="text" className="s-input" placeholder="G√∂lhisar, Yavuz, 4 Yol... Hƒ±zlƒ± Bul" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                                    {searchTerm && <button onClick={() => setSearchTerm('')} className="absolute right-4 top-1/2 -translate-y-1/2 text-white/50 transition-all"><SafeIcon name="close" size={16} /></button>}
                                </div>
                            )}
                        </div>
                    </header>

                    <main className="flex-1 p-5 max-w-2xl mx-auto w-full pb-24 overflow-x-hidden no-s">
                        {activeTab === 'liste' && selectedRegion === 'Anasayfa' && !searchTerm ? (
                            <div className="reveal grid grid-cols-3 gap-4">
                                <h2 className="col-span-3 text-slate-400 font-black text-[11px] uppercase tracking-[0.4em] mb-4 text-center">B√ñLGELER</h2>
                                {regionList.filter(r => r !== 'Anasayfa').map(reg => (
                                    <button key={reg} onClick={() => setSelectedRegion(reg)} className="r-card shadow-xl shadow-slate-200/50">
                                        <div className="bg-indigo-50 p-4 rounded-2xl mb-2.5 shadow-inner" style={{ color: themeOptions[themeIndex].main }}><SafeIcon name="map" size={24} /></div>
                                        <span className="text-[11px] font-black uppercase truncate w-full text-slate-800 text-center">{reg}</span>
                                    </button>
                                ))}
                                <div className="col-span-3 mt-16 py-6 border-t border-slate-200 text-center flex flex-col gap-4">
                                    <button onClick={restoreCheckPoint} className="text-[10px] font-black text-emerald-600 flex items-center justify-center gap-2 uppercase tracking-[0.3em] active:scale-95"><SafeIcon name="refresh" size={14} /> KONTROL NOKTASINA D√ñN</button>
                                    <button onClick={hardReset} className="text-[10px] font-black text-slate-300 flex items-center justify-center gap-2 uppercase tracking-[0.3em] active:text-rose-500"><SafeIcon name="trash" size={14} /> Sƒ∞STEMƒ∞ SIFIRLA</button>
                                </div>
                            </div>
                        ) : activeTab === 'liste' ? (
                            <div className="reveal">
                                <div className="flex justify-between items-center mb-8 px-2">
                                    <div>
                                        <h2 className="text-slate-400 font-black text-[11px] uppercase tracking-[0.4em] italic">{searchTerm ? 'ARAMA ANALƒ∞Zƒ∞' : selectedRegion}</h2>
                                        <p className="text-[10px] font-bold text-indigo-400 mt-2.5 uppercase">{finalDisplayList.length} NOKTA BULUNDU</p>
                                    </div>
                                    <button onClick={() => { setSelectedRegion('Anasayfa'); setSearchTerm(''); }} className="text-[11px] font-black text-indigo-600 border-b-2 border-indigo-100 uppercase tracking-[0.2em] pb-1">GERƒ∞ D√ñN</button>
                                </div>
                                {finalDisplayList.map(item => <DealerItem key={item.id} item={item} theme={themeOptions[themeIndex].main} onToggle={handleToggleVisit} onRemove={handleRemoveDealer} onNote={id => triggerModal(id, 'note')} />)}
                                {finalDisplayList.length === 0 && <div className="py-40 text-center opacity-20 flex flex-col items-center gap-8 grayscale"><SafeIcon name="logo" size={96} /><p className="font-black text-lg uppercase tracking-[0.5em]">Kayƒ±t Yok</p></div>}
                            </div>
                        ) : (
                            <div className="reveal space-y-8 text-center">
                                <div className="bg-white p-14 rounded-[56px] shadow-2xl border border-slate-100 relative overflow-hidden flex flex-col items-center">
                                    <p className="text-[14px] font-black text-slate-400 uppercase mb-6 tracking-[0.5em]">VERƒ∞MLƒ∞Lƒ∞K SKORU</p>
                                    <div className="text-[130px] font-black text-slate-900 tracking-tighter italic leading-none drop-shadow-xl select-none">%{stats.ratio}</div>
                                    <div className="grid grid-cols-2 gap-6 mt-16 w-full uppercase">
                                        <div className="bg-slate-50 p-8 rounded-[32px] flex flex-col items-center shadow-sm">
                                            <p className="text-[10px] font-black text-slate-400 mb-2">TOPLAM</p>
                                            <p className="text-5xl font-black text-slate-900">{stats.total}</p>
                                        </div>
                                        <div className="bg-emerald-50 p-8 rounded-[32px] flex flex-col items-center shadow-sm">
                                            <p className="text-[10px] font-black text-emerald-500 mb-2">Bƒ∞TEN</p>
                                            <p className="text-5xl font-black text-emerald-600">{stats.done}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="b-bar shadow-[0_-8px_40px_rgba(0,0,0,0.12)] px-12">
                        <button onClick={() => { setActiveTab('liste'); setSelectedRegion('Anasayfa'); window.scrollTo(0,0); }} className={`nav-item active:scale-110 ${activeTab === 'liste' ? 'nav-active' : 'text-slate-300 opacity-60'}`}>
                            <SafeIcon name="home" size={20} /><span className="text-[8px] font-black uppercase tracking-[0.2em] mt-1">PANEL</span>
                        </button>
                        <button onClick={() => triggerModal(null, 'new')} className="bg-[#0F172A] text-white p-2.5 rounded-2xl -mt-8 border-[6px] border-[#F8FAFC] shadow-2xl active:scale-90 flex items-center justify-center">
                            <SafeIcon name="plus" size={20} />
                        </button>
                        <button onClick={() => { setActiveTab('ozet'); window.scrollTo(0,0); }} className={`nav-item active:scale-110 ${activeTab === 'ozet' ? 'nav-active' : 'text-slate-300 opacity-60'}`}>
                            <SafeIcon name="chart" size={20} /><span className="text-[8px] font-black uppercase tracking-[0.2em] mt-1">RAPOR</span>
                        </button>
                    </nav>

                    {modal.open && (
                        <div className="m-overlay animate-in fade-in duration-300" onClick={(e) => e.target === e.currentTarget && setModal({ open: false, type: null, id: null })}>
                            <div className="m-content animate-reveal relative">
                                <div className="flex justify-between items-center mb-8">
                                    <h2 className="text-[13px] font-black uppercase tracking-[0.4em] text-slate-400 italic">{modal.type === 'note' ? 'Zƒ∞YARET ANALƒ∞Zƒ∞' : 'YENƒ∞ KAYIT Sƒ∞STEMƒ∞'}</h2>
                                    <button onClick={() => setModal({ open: false, type: null, id: null })} className="p-3 bg-slate-50 rounded-2xl text-slate-400 active:bg-rose-500 active:text-white transition-all shadow-sm"><SafeIcon name="close" size={18} /></button>
                                </div>
                                {modal.type === 'note' ? (
                                    <div className="space-y-8">
                                        <textarea className="w-full bg-slate-50 border border-slate-100 rounded-[24px] p-6 text-[14px] outline-none h-48 font-bold shadow-inner focus:ring-4 focus:ring-indigo-50" placeholder="Ziyaret notlarƒ±..." value={form.note} onChange={e => setForm({...form, note: e.target.value})} />
                                        <button onClick={processSave} className="w-full py-5.5 rounded-[24px] bg-indigo-600 text-white font-black uppercase text-[12px] tracking-[0.3em] shadow-2xl active:scale-95" style={{ backgroundColor: themeOptions[themeIndex].main }}>KAYDET</button>
                                    </div>
                                ) : (
                                    <form onSubmit={(e) => { e.preventDefault(); processSave(); }} className="space-y-5">
                                        <input type="text" placeholder="√únvan" required className="w-full bg-slate-50 border border-slate-100 rounded-[20px] p-5 text-[12px] font-bold uppercase outline-none focus:ring-4 focus:ring-indigo-50 shadow-inner" value={form.bayi} onChange={e => setForm({...form, bayi: e.target.value})} />
                                        <input type="text" placeholder="B√∂lge" required className="w-full bg-slate-50 border border-slate-100 rounded-[20px] p-5 text-[12px] font-bold uppercase outline-none focus:ring-4 focus:ring-indigo-50 shadow-inner" value={form.bolge} onChange={e => setForm({...form, bolge: e.target.value})} />
                                        <button type="submit" className="w-full py-5.5 rounded-[24px] bg-[#0F172A] text-white font-black uppercase text-[12px] tracking-[0.3em] shadow-2xl active:scale-95 mt-6">EKLE</button>
                                    </form>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const rootContainer = document.getElementById('root');
        const root = ReactDOM.createRoot(rootContainer);
        root.render(<App />);
    </script>
</body>
</html>
